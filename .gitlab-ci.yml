stages:
  - test
  - release

unit-test:  
  stage: test
  image: golang
  script:
    - go install gotest.tools/gotestsum@latest
    - gotestsum --junitfile report.xml --format testname
  artifacts:
    reports:
      junit: report.xml

release:
  stage: release
  image:
    name: gitlab/glab:latest
    entrypoint: [ "" ]
  script:
    - glab auth login -h ${CI_SERVER_HOST} -t ${PROJECT_ACCESS_TOKEN}
    #- glab changelog generate --from 3c16d52f7bf6d2f1b2b38aae9aded10b809850aa --version ${CI_COMMIT_TAG} > changelog.md
    - glab changelog generate --version ${CI_COMMIT_TAG} > changelog.md
    - glab release create ${CI_COMMIT_TAG} -F changelog.md
  rules:
    - if: $CI_COMMIT_TAG
